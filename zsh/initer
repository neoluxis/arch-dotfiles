# 环境初始化工具
nlx_init_ros2() {
    # ROS2 环境初始化，Humble支援
    if [ -f /opt/ros/humble/setup.zsh ]; then
        export ROS_DOMAIN_ID=42
        source /opt/ros/humble/setup.zsh
    else
        echo "No ROS Humble Installation Found!! "
        return 1
    fi
}

nlx_init_conda() {
    # Conda 环境初始化，Anaconda与Miniconda支援
    if [ -f /opt/anaconda/bin/conda ]; then
        export CONDA=anaconda
        export CONDA_PREFIX=/opt/anaconda
    elif [ -f /opt/miniconda3/bin/conda ]; then
        export CONDA=miniconda
        export CONDA_PREFIX=/opt/miniconda3
    else
        echo "No Conda Installation Found! "
        return 1
    fi

    __conda_setup="$(\"${CONDA_PREFIX}/bin/conda\" 'shell.zsh' 'hook' 2> /dev/null)"
    if [ $? -eq 0 ]; then
        eval "$__conda_setup"
    else
        if [ -f "${CONDA_PREFIX}/etc/profile.d/conda.sh" ]; then
            . "${CONDA_PREFIX}/etc/profile.d/conda.sh"
        else
            export PATH="${CONDA_PREFIX}/bin:$PATH"
        fi
    fi
    unset __conda_setup

    # 用于防止 SSL 报错，或者可以通过root后更新conda base环境解决
    export CRYPTOGRAPHY_OPENSSL_NO_LEGACY=1
}
nlx_init_oneapi() {
    # Intel Oneapi 环境初始化
    if [ -f /opt/intel/oneapi/setvars.sh ]; then
        LOGFILE="/tmp/intel-oneapi-init-$(whoami)-$(date '+%Y-%m-%d_%H-%M-%S').log"
        source /opt/intel/oneapi/setvars.sh > "$LOGFILE" 2>&1
    fi
}

nlx_init_pyenv() {
    export PYENV_ROOT="$HOME/.pyenv"
    [[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init - zsh)"
}

# 环境初始化
initer() {
	if [ "$1" = "ros2" ]; then
		nlx_init_ros2
	elif [ "$1" = "conda" ]; then
        nlx_init_conda
	elif [ "$1" = "pyenv" ]; then
        nlx_init_pyenv
	elif [ "$1" = "oneapi" ]; then
        nlx_init_oneapi
	else
		echo "Usage: initer <ros2|conda|oneapi> [-h]"
	fi
}
